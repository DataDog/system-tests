name: "Compute libraries impacted by the change"

on:
  workflow_call:
    outputs:
      impacted_libraries:
        description: "JSON list of libraries impacted by the change"
        value: ${{ jobs.main.outputs.impacted_libraries }}

jobs:
  main:
    runs-on: ubuntu-latest
    outputs:
      impacted_libraries: ${{ steps.compute_impacted_libraries.outputs.result }}
    steps:
      - name: Compute impacted libraries
        id: compute_impacted_libraries
        shell: python
        run: |
          import os
          import json

          pr_title = os.environ["PR_TITLE"].lower()

          if pr_title.startswith("[cpp]"):
            result=["cpp"]
          elif pr_title.startswith( "[dotnet]"):
            result=["dotnet"]
          elif pr_title.startswith( "[golang]"):
            result=["golang"]
          elif pr_title.startswith( "[java]"):
            result=["java"]
          elif pr_title.startswith( "[nodejs]"):
            result=["nodejs"]
          elif pr_title.startswith( "[php]"):
            result=["php"]
          elif pr_title.startswith( "[python]"):
            result=["python"]
          elif pr_title.startswith( "[ruby]"):
            result=["ruby"]
          else:
            result=["cpp","dotnet","golang","java","nodejs","php","python","ruby"]

          with open(os.environ['GITHUB_OUTPUT'], 'a') as fh:
            print(f'result={json.dumps(result)}', file=fh)

        env:
          PR_TITLE: ${{ github.event.pull_request.title }}

      - name: Print results
        run: |
          echo 'Impacted libraries: -> ${{ steps.compute_impacted_libraries.outputs.result }}'
