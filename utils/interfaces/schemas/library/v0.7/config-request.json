{
  "$id": "/library/v0.7/config-request.json",

  "required": ["client"],
  "properties": {
    "client": {
      "required": ["id", "state", "is_tracer", "client_tracer"],
      "properties": {
        "id": { "$ref": "#/definitions/non-empty-string" },
        "is_tracer": {
          "const": true
        },
        "state": {
          "required": ["root_version", "targets_version"],
          "properties": {
            "root_version": { 
              "$comment": "Must be set to 1 until root updates are supported",
              "const": 1
            },
            "targets_version": { "type": "integer" },
            "has_error": { "type": "boolean" },
            "error": { "$ref": "#/definitions/non-empty-string" }
          }
        },
        "client_tracer": {
          "required": ["runtime_id", "service", "env", "app_version", "tracer_version"],
          "properties": {
            "runtime_id": { "$ref": "#/definitions/non-empty-string" },
            "service": { "$ref": "#/definitions/non-empty-string" },
            "env": { "$ref": "#/definitions/non-empty-string" },
            "app_version": { "$ref": "#/definitions/non-empty-string" },
            "tracer_version": { "$ref": "#/definitions/non-empty-string" },
            "language": {"enum": ["cpp", "dotnet", "go", "node", "java", "php", "python", "ruby"]}
          }
        },
        "products": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      }
    }
  },
  "definitions": {
    "non-empty-string": {
      "type": "string",
      "minLength": 1
    }
  }
}
