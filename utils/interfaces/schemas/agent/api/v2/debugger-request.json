{
  "$id": "/agent/api/v2/debugger-request.json",
  "type": "array",
  "items": {
    "type": "object",
    "oneOf": [
      {
        "properties": {
          "dd.span_id": { "type": "string" },
          "dd.trace_id": { "type": "string" },
          "ddsource": { "type": "string" },
          "duration": { "type": "number" },
          "logger.method": { "type": "string" },
          "logger.name": { "type": "string" },
          "logger.thread_id": { "type": "number" },
          "logger.thread_name": { "type": "string" },
          "logger.version": { "type": "number" },
          "message": { "type": "string" },
          "service": { "type": "string" },
          "timestamp": { "type": "number" },
          "debugger": {
            "type": "object",
            "oneOf": [
              {
                "properties": {
                  "diagnostics": {
                    "type": "object",
                                    "properties": {
                  "probeId": { "type": "string" },
                  "probeVersion": { "type": "number" },
                  "runtimeId": { "type": "string" },
                  "status": { "enum": ["RECEIVED", "INSTALLED", "EMITTING", "ERROR", "BLOCKED"] },
                  "exception": {
                    "type": "object",
                    "properties": {
                      "message": { "type": "string" },
                      "stacktrace": { "type": "string" }
                    }
                  },
                  "query": { "type": "object" }
                },
                                    "required": [
                  "probeId",
                  "runtimeId",
                  "status"
                ]
                  }
                },
                "required": ["diagnostics"]
              },
              {
                "properties": {
                  "snapshot": {
                    "type": "object",
                    "properties": {
                      "captures": { "type": "object" },
                      "id": { "type": "string" },
                      "language": { "type": "string" },
                      "timestamp": { "type": "number" },
                      "exceptionId": { "type": "string" },
                      "exceptionHash": { "type": "string" },
                      "frameIndex": { "type": "string" },
                      "probe": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "version": { "type": "number" },
                          "location": {
                            "type": "object",
                            "properties": {
                              "file": { "type": "string" },
                              "lines": {
                                "type": "array",
                                "items": { "type": "string" }
                              },
                              "method": { "type": "string" },
                              "type": { "type": "string" }
                            }
                          }
                        }
                      },
                      "stack": {
                        "type": "array",
                        "items": {
                          "properties": {
                            "fileName": { "type": "string" },
                            "lineNumber": { "type": "number" },
                            "function": { "type": "string" }
                          }
                        }
                      }
                    }
                  }
                },
                "required": ["snapshot"]
              }
            ]
          }
        },
        "required": [
          "ddsource",
          "debugger"
        ]
      },
      {
        "properties": {
          "ddsource": { "type": "string" },
          "service": { "type": "string" },
          "runtimeId": { "type": "string" }
        },
        "required": [
          "ddsource",
          "service",
          "runtimeId"
        ],
        "not": {
          "anyOf": [
            { "required": ["debugger"] },
            { "required": ["env"] },
            { "required": ["language"] },
            { "required": ["scopes"] }
          ]
        }
      },
      {
        "properties": {
          "env": { "type": "string" },
          "language": { "type": "string" },
          "version": { "type": "string" },
          "scopes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "end_line": { "type": "number" },
                "name": { "type": "string" },
                "scope_type": { "type": "string" },
                "scopes": { "type": "array" },
                "language_specifics": { "type": "object" },
                "source_file": { "type": "string" },
                "start_line": { "type": "number" },
                "symbols": { "type": "array" }
              }
            }
          }
        },
        "required": [
          "language"
        ]
      }
    ]
  }
}
