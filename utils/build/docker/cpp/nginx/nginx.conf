load_module modules/ngx_http_datadog_module.so;

events {
    worker_connections  1024;
}

http {
    datadog_enable;
    datadog_tag http_user_agent $http_user_agent;
    # opentracing_trace_locations off;
    datadog_operation_name "$request_method $uri";
    # log_format with_trace_id "$remote_addr - $http_x_forwarded_user [$time_local] \"$request\" "
    #                          "$status $body_bytes_sent \"$http_referer\" "
    #                          "\"$http_user_agent\" \"$http_x_forwarded_for\" "
    #                          "\"$datadog_span_id\" \"$datadog_trace_id\"";
    # access_log /var/log/nginx/access.log with_trace_id;
    access_log /var/log/nginx/access.log;
    server {
        listen       7777;
        server_name  0.0.0.0;
        location ~* /sample_rate/([0-9]+) { return 200 "OK"; }
        location / { return 200 "Hello world\n"; }
    }
}
