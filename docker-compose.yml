# Unless explicitly stated otherwise all files in this repository are licensed under the the Apache License Version 2.0.
# This product includes software developed at Datadog (https://www.datadoghq.com/).
# Copyright 2021 Datadog, Inc.

version: "2.4"
services:

  runner:
    container_name: runner
    image: system_tests/runner
    networks:
      - system-tests_default
    environment:
      - HOST_PWD
      - WEBLOG_ENV
      - PYTHONDONTWRITEBYTECODE=1  # prevent root ownership issues
      - DD_API_KEY
      - DD_APPLICATION_KEY=${DD_APPLICATION_KEY:-}
      - COLUMNS=${COLUMNS:-120}
      - PYTHONPATH=/app
      - DD_SITE=${DD_SITE:-datad0g.com}
      # - DD_URL=https://app.datad0g.com
      - SYSTEM_TESTS_AGENT_DD_APM_RECEIVER_PORT=8126 # need to know where is the agent
      - SYSTEMTESTS_SCENARIO=${SYSTEMTESTS_SCENARIO:-DEFAULT}
      - SYSTEMTESTS_PROXY_STATE=${SYSTEMTESTS_PROXY_STATE:-}
      - DD_AGENT_HOST
      - DD_TRACE_AGENT_PORT=8126
    volumes:
      - ./scenarios/:/app/scenarios/:ro
      - ./tests/:/app/tests/:ro
      - ./utils/:/app/utils/:ro
      - ./pyproject.toml:/app/pyproject.toml:ro
      - ./conftest.py:/app/conftest.py:ro
      - ./${SYSTEMTESTS_LOG_FOLDER:-logs}/:/app/logs/
      - /var/run/docker.sock:/var/run/docker.sock
    command: ${RUNNER_CMD:-pytest} ${RUNNER_ARGS:-}

networks:
  system-tests_default:
    name: system-tests_default
