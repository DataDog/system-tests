# Unless explicitly stated otherwise all files in this repository are licensed under the the Apache License Version 2.0.
# This product includes software developed at Datadog (https://www.datadoghq.com/).
# Copyright 2021 Datadog, Inc.

version: "2.4"
services:

  agent:
    build:
      context: ../..
      dockerfile: utils/build/docker/agent.Dockerfile
    environment:
      - DD_API_KEY=$DD_API_KEY
      - DD_SITE=${DD_SITE:-datad0g.com}

  dotnet:
    build:
      context: ../..
      dockerfile: utils/build/docker/dotnet/poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-dotnet
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8080:7777

  golang:
    build:
      context: ../..
      dockerfile: utils/build/docker/golang/net-http-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-golang
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8081:7777

  java:
    build:
      context: ../..
      dockerfile: utils/build/docker/java/spring-boot-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-java
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8082:7777

  java:
    build:
      context: ../..
      dockerfile: utils/build/docker/java/spring-boot-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-java
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8082:7777

  nodejs:
    build:
      context: ../..
      dockerfile: utils/build/docker/nodejs/express-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-nodejs
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8083:7777

  php:
    build:
      context: ../..
      dockerfile: utils/build/docker/php/vanilla-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-nodejs
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8084:7777

  python:
    build:
      context: ../..
      dockerfile: utils/build/docker/python/flask-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-python
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8085:7777

  ruby:
    build:
      context: ../..
      dockerfile: utils/build/docker/ruby/sinatra-poc.Dockerfile
    environment:
      - DD_AGENT_HOST=agent
      - DD_TRACE_AGENT_PORT=8126
      - DD_APPSEC_ENABLED=1
      - DD_SERVICE=weblog-ruby
      - DD_TRACE_DEBUG
      - DD_ENV=k9-weblog
    depends_on:
      agent:
        condition: service_healthy
    ports:
       - 8086:7777
