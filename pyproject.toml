[tool.black]
line-length = 120
exclude = "(venv/|utils/grpc/weblog_pb2_grpc.py|utils/grpc/weblog_pb2.py|parametric/apps|parametric/protos/)"

[tool.pytest.ini_options]
addopts = "--json-report --json-report-indent=2 --color=yes --no-header --junitxml=reportJunit.xml -r Xf"
testpaths = [
    "tests",
]
# log_cli = True
# log_cli_level = DEBUG
log_level = "DEBUG"
log_format = "%(asctime)s.%(msecs)03d %(levelname)-8s %(message)s"
log_date_format = "%H:%M:%S"
log_file_format = "%(asctime)s.%(msecs)03d %(levelname)-8s %(message)s"
log_file_date_format = "%H:%M:%S"

junit_family = "xunit2"
junit_logging = "no"
junit_duration_report = "call"
junit_suite_name = "system_tests_suite"

markers =[
    "scenario: run a test only for a specified scenario",
    "features: declare the feature id"
]

python_files = "test_*.py _test_*.py"

# migration tooling: list of folders where feature declarations are mandatory
# once every test class got its feature declaration, we can remove this
allow_no_feature_nodes = [
    "tests/apm_tracing_e2e/test_otel.py",
    "tests/apm_tracing_e2e/test_single_span.py",
    "tests/apm_tracing_e2e/test_smoke.py",
    "tests/integrations/test_dbm.py",
    "tests/integrations/test_dsm.py",
    "tests/integrations/test_mongo.py",
    "tests/integrations/test_open_telemetry.py",
    "tests/integrations/test_sql.py",
    "tests/onboarding/test_onboarding_install.py",
    "tests/otel_tracing_e2e/test_e2e.py",
    "tests/parametric/test_128_bit_traceids.py",
    "tests/parametric/test_dynamic_configuration.py",
    "tests/parametric/test_headers_b3.py",
    "tests/parametric/test_headers_b3multi.py",
    "tests/parametric/test_headers_datadog.py",
    "tests/parametric/test_headers_none.py",
    "tests/parametric/test_headers_precedence.py",
    "tests/parametric/test_headers_tracecontext.py",
    "tests/parametric/test_headers_tracestate_dd.py",
    "tests/parametric/test_library_tracestats.py",
    "tests/parametric/test_otel_span_methods.py",
    "tests/parametric/test_otel_span_with_w3c.py",
    "tests/parametric/test_otel_tracer.py",
    "tests/parametric/test_partial_flushing.py",
    "tests/parametric/test_sampling_span_tags.py",
    "tests/parametric/test_span_links.py",
    "tests/parametric/test_span_sampling.py",
    "tests/parametric/test_trace_sampling.py",
    "tests/parametric/test_tracer_flare.py",
    "tests/parametric/test_tracer.py",
    "tests/perfs/test_performances.py",
    "tests/remote_config/test_remote_configuration.py",
    "tests/test_data_integrity.py",
    "tests/test_distributed.py",
    "tests/test_library_logs.py",
    "tests/test_miscs.py",
    "tests/test_profiling.py",
    "tests/test_schemas.py",
    "tests/test_semantic_conventions.py",
    "tests/test_smoke.py",
    "tests/test_telemetry.py",
    "tests/test_identify.py",
    "tests/test_library_conf.py",
    "tests/test_remote_config.py",
    "tests/test_scrubbing.py",
    "tests/test_no_ip_is_reported.py",
    "tests/appsec/test_user_blocking_full_denylist.py",
    "tests/appsec/test_docs.py",
    "tests/appsec/test_endpoint_ognl.py",
    "tests/appsec/test_endpoint_sqli.py",
    "tests/appsec/test_endpoint_ssrf.py",
    "tests/appsec/api_security/test_schemas.py",
    "tests/appsec/test_blocking_addresses.py",
    "tests/appsec/test_request_blocking.py",
    "tests/appsec/test_runtime_activation.py",
    "tests/appsec/test_logs.py",
    "tests/appsec/test_versions.py",
    "tests/appsec/test_PII.py",
    "tests/appsec/test_client_ip.py",
    "tests/appsec/iast/sink/test_hsts_missing_header.py",
    "tests/appsec/iast/sink/test_no_httponly_cookie.py",
    "tests/appsec/iast/sink/test_insecure_cookie.py",
    "tests/appsec/iast/sink/test_nosql_mongodb_injection.py",
    "tests/appsec/iast/sink/test_no_samesite_cookie.py",
    "tests/appsec/iast/sink/test_ssrf.py",
    "tests/appsec/iast/sink/test_trust_boundary_violation.py",
    "tests/appsec/iast/sink/test_unvalidated_redirect_forward.py",
    "tests/appsec/iast/sink/test_unvalidated_redirect.py",
    "tests/appsec/iast/sink/test_weak_randomness.py",
    "tests/appsec/iast/sink/test_xcontent_sniffing.py",
    "tests/appsec/iast/sink/test_xpath_injection.py",
    "tests/appsec/iast/sink/test_xss.py",
    "tests/appsec/iast/source/test_multipart.py",
    "tests/appsec/iast/source/test_path.py",
    "tests/appsec/iast/source/test_uri.py",
    "tests/appsec/waf/test_custom_rules.py",
    "tests/appsec/waf/test_exclusions.py",
    "tests/appsec/waf/test_miscs.py",
    "tests/appsec/waf/test_rules.py",
    "tests/appsec/waf/test_telemetry.py",
    "tests/test_the_test/",
]

[tool.pylint]
init-hook='import sys; sys.path.append(".")'
max-line-length = 120
disable = [
    "missing-module-docstring",
    "missing-class-docstring",
    "missing-function-docstring",
    "fixme",
    "raise-missing-from",
    "invalid-name",
    "import-outside-toplevel",
    "logging-fstring-interpolation",
    "broad-except",
    "too-few-public-methods",
    "too-many-arguments",
    "too-many-branches,",
    "bare-except",
    "too-many-instance-attributes",
    "too-many-locals",
    "too-many-public-methods",
    "too-many-nested-blocks",
    "too-many-return-statements",
    "duplicate-code",
    "abstract-method",
    "inconsistent-return-statements", # because lot of validator function returns nothing
    "unused-argument", # pain, as there are some function that MUST have a prototype. TODO...
    "attribute-defined-outside-init",
]
ignore-paths = [
    "utils/parametric/protos/.*"  # generated by grpc
]
generated-members = [
    "pb\\.(DistributedHTTPHeaders|FlushSpansArgs|FlushTraceStatsArgs|HeaderTuple|InjectHeadersArgs)",
    "pb\\.(StartSpanArgs|StopTracerArgs|SpanSetMetaArgs|SpanSetMetricArgs|SpanSetErrorArgs|FinishSpanArgs)",
    "pb\\.(Otel.*|ListVal|AttrVal|Attributes)",
    "(ok_summary|err_summary)\\.mapping",
    "Span\\.__annotations__"
]
