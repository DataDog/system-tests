 #Add initial configuration that it must do after start the machine 
- os_type: linux
  os_distro: deb
  command: |
    #Disable auto updates. It could raise problems if the update proccess is launched just when we are trying to install de software 
    sudo sed -i 's/1/0/g' /etc/apt/apt.conf.d/20auto-upgrades
    sudo sed -i 's/1/0/g'  /etc/apt/apt.conf.d/10periodic || true
    sudo apt-get -y remove unattended-upgrades || true
    sudo apt-get -y remove update-manager || true
    sudo rm -rf /etc/cron.daily/update-notifier-common || true
    sudo rm -rf /etc/cron.weekly/update-notifier-common || true
    sudo systemctl disable --now apt-daily.service
    sudo systemctl disable --now apt-daily.timer
    sudo systemctl disable --now apt-daily-upgrade.timer
    sudo systemctl disable --now apt-daily-upgrade.service

    sudo systemctl kill --kill-who=all apt-daily.service
    # wait until `apt-get updated` has been killed
    start=$EPOCHSECONDS
    while ! (systemctl list-units --all apt-daily.service | egrep -q '(dead|failed)')
    do
      sleep 1;
      if (( EPOCHSECONDS-start > 60 )); then break; fi
    done
    sudo id -u datadog &>/dev/null || sudo useradd -m datadog
 
- os_type: linux
  os_distro: rpm
  command: |
    sudo id -u datadog &>/dev/null || sudo useradd -m datadog 