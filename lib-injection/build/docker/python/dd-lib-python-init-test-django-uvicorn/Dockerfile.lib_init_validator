ARG LIB_INIT_ENV=prod

FROM docker.io/datadog/dd-lib-python-init:latest as dd-lib-init_prod

FROM ghcr.io/datadog/dd-trace-py/dd-lib-python-init:latest_snapshot as dd-lib-init_dev

FROM dd-lib-init_${LIB_INIT_ENV} as dd-lib-python-init

FROM python:3.9

ENV PYTHONUNBUFFERED 1
ENV DJANGO_SETTINGS_MODULE django_app
WORKDIR /src
ADD . /src
COPY --from=dd-lib-python-init /datadog-init /datadog-lib/
ENV PYTHONPATH="/datadog-lib/"
ENV DD_INSTALL_DDTRACE_PYTHON="1"
RUN pip install django uvicorn
EXPOSE 18080
CMD uvicorn --host 0.0.0.0 --port 18080 django_app:application
